# Story 1.1a-Followup: Comprehensive Hierarchical Test Data

## Status
Draft

## Story

**As a** developer,
**I want** comprehensive hierarchical test data with complex parent-child task relationships,
**so that** I can thoroughly test task breakdown features, performance with nested data, and edge cases in the task hierarchy system.

## Acceptance Criteria

1. Reliable seeding system that handles hierarchical task creation without foreign key violations
2. Deep task hierarchies (3+ levels) for testing recursive operations and UI rendering
3. Complex test scenarios including edge cases, performance stress testing, and boundary conditions
4. Automated validation of hierarchical data integrity after seeding
5. Performance benchmarking with large hierarchical datasets (100+ tasks)
6. Comprehensive coverage of task breakdown scenarios (manual, rule-based, AI-generated)

## Tasks / Subtasks

- [ ] Fix hierarchical data seeding system (AC: 1)
  - [ ] Resolve UUID management issues in JavaScript seeding
  - [ ] Implement proper parent-child insertion ordering
  - [ ] Add foreign key constraint validation and error handling
  - [ ] Create rollback mechanism for failed hierarchical insertions
- [ ] Create comprehensive hierarchical test scenarios (AC: 2, 3)
  - [ ] Deep nested project with 3-4 levels of task breakdown
  - [ ] Complex multi-user scenario with shared and private hierarchies
  - [ ] Edge cases: circular references, orphaned tasks, deep nesting limits
  - [ ] Performance dataset: 20+ parent tasks with 100+ total subtasks
  - [ ] Boundary testing: maximum task depth, title length, description size
- [ ] Implement data integrity validation (AC: 4)
  - [ ] Automated checks for orphaned tasks (parent_task_id references non-existent tasks)
  - [ ] Validation of task_level consistency with actual hierarchy depth
  - [ ] Sequence_order validation within parent task groups
  - [ ] User ownership consistency across hierarchies
- [ ] Performance benchmarking and optimization (AC: 5)
  - [ ] Load testing with 500+ tasks across multiple hierarchies
  - [ ] Query performance analysis for deep hierarchy traversal
  - [ ] Database index optimization for hierarchical queries
  - [ ] Memory usage profiling during large dataset operations
- [ ] Task breakdown scenario coverage (AC: 6)
  - [ ] Manual task breakdown examples (user-created subtasks)
  - [ ] Rule-based breakdown examples (template-driven task creation)
  - [ ] AI-generated breakdown simulation (complex project decomposition)
  - [ ] Mixed breakdown sources within single hierarchy

## Dev Notes

### Technical Challenges Addressed

From Story 1.1a implementation, the following issues need resolution:
1. **UUID Management**: JavaScript crypto.randomUUID() vs database-generated UUIDs
2. **Insertion Order**: Ensuring parent tasks exist before inserting children
3. **Batch Processing**: Handling large hierarchical datasets efficiently
4. **Transaction Safety**: Atomic operations for complex hierarchy creation

### Hierarchical Test Scenarios

#### Scenario 1: Software Development Project
```
Launch Mobile App (Level 0)
├── Frontend Development (Level 1)
│   ├── UI Component Library (Level 2)
│   │   ├── Button Components (Level 3)
│   │   ├── Form Components (Level 3)
│   │   └── Navigation Components (Level 3)
│   ├── Screen Implementation (Level 2)
│   └── State Management (Level 2)
├── Backend Development (Level 1)
│   ├── API Design (Level 2)
│   ├── Database Schema (Level 2)
│   └── Authentication System (Level 2)
└── Testing & Deployment (Level 1)
```

#### Scenario 2: Home Renovation Project  
```
Kitchen Renovation (Level 0)
├── Planning & Design (Level 1)
│   ├── Budget Planning (Level 2)
│   ├── Contractor Selection (Level 2)
│   └── Permit Applications (Level 2)
├── Demolition (Level 1)
├── Installation (Level 1)
│   ├── Electrical Work (Level 2)
│   ├── Plumbing (Level 2)
│   └── Flooring (Level 2)
└── Finishing Touches (Level 1)
```

#### Scenario 3: Performance Stress Testing
- 50 top-level projects
- Average 5 subtasks per parent (250 level 1 tasks)  
- Average 3 sub-subtasks per subtask (750 level 2 tasks)
- Total: ~1000+ tasks in hierarchical relationships

### Database Optimization Requirements

```sql
-- Enhanced indexes for hierarchical queries
CREATE INDEX idx_tasks_hierarchy_path ON tasks(user_id, parent_task_id, task_level, sequence_order);
CREATE INDEX idx_tasks_deep_hierarchy ON tasks USING GIN ((ARRAY[user_id, parent_task_id]));

-- Recursive query performance
WITH RECURSIVE task_hierarchy AS (
  SELECT id, title, parent_task_id, task_level, 0 as depth 
  FROM tasks WHERE parent_task_id IS NULL
  UNION ALL
  SELECT t.id, t.title, t.parent_task_id, t.task_level, th.depth + 1
  FROM tasks t JOIN task_hierarchy th ON t.parent_task_id = th.id
) SELECT * FROM task_hierarchy WHERE depth < 10;
```

### Success Metrics

1. **Reliability**: 100% successful seeding of hierarchical datasets without constraint violations
2. **Performance**: Sub-200ms queries for hierarchies up to 1000 tasks
3. **Coverage**: All breakdown scenarios (manual, rule, AI) represented in test data
4. **Integrity**: Zero orphaned tasks, consistent task_level values, proper sequence ordering
5. **Scalability**: System handles 10x current dataset size without degradation

## Dependencies

- Requires Story 1.1a (Development Database & Test Data) to be completed
- Database schema and RLS policies must be in place
- Supabase Auth integration functional

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-03 | 1.0 | Follow-up story for comprehensive hierarchical test data | James (Dev Agent) |

## Dev Agent Record

*This section will be populated during implementation*

## QA Results

*This section will be populated during QA review*