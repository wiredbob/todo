# Story 1.1b: Testing & CI/CD Infrastructure

## Status
Draft

## Story

**As a** developer,
**I want** automated testing and CI/CD pipeline configured,
**so that** I can develop with confidence and deploy reliably.

## Acceptance Criteria

1. Frontend and backend test frameworks configured (Vitest, React Testing Library)
2. Sample tests created and passing for basic components and API functions
3. Test scripts configured in package.json for monorepo
4. GitHub Actions CI/CD pipeline configured for automated testing
5. Vercel deployment integration configured with environment management
6. Health check endpoints functional for monitoring
7. Code quality tools configured (ESLint, Prettier, TypeScript strict mode)

## Tasks / Subtasks

- [ ] Set up testing infrastructure (AC: 1, 2, 3)
  - [ ] Configure Vitest for both frontend and backend packages
  - [ ] Set up React Testing Library for component testing
  - [ ] Create sample component tests (Hello World page)
  - [ ] Create sample API function tests (health endpoint)
  - [ ] Configure test scripts in package.json for monorepo
  - [ ] Ensure all tests pass and can run in isolation
- [ ] Configure CI/CD pipeline (AC: 4, 5)
  - [ ] Set up GitHub Actions workflow for pull requests
  - [ ] Configure automated testing on all commits
  - [ ] Set up Vercel deployment integration
  - [ ] Configure environment variable management for deployments
  - [ ] Test deployment pipeline with sample PR
- [ ] Create monitoring endpoints (AC: 6)
  - [ ] Build frontend health check showing build info and version
  - [ ] Create backend API health check with service status
  - [ ] Add database connectivity check to health endpoint
  - [ ] Include environment and deployment information
- [ ] Configure code quality tools (AC: 7)
  - [ ] Set up ESLint with TypeScript rules for monorepo
  - [ ] Configure Prettier for consistent code formatting
  - [ ] Enable TypeScript strict mode across all packages
  - [ ] Add pre-commit hooks for code quality
  - [ ] Configure VS Code settings for development team

## Dev Notes

### Testing Strategy
Implements testing pyramid approach:
- **Unit Tests**: Component logic, API function logic, utility functions
- **Integration Tests**: API endpoints with mock database, component integration
- **Future E2E**: Playwright (handled in later stories)

### Test File Structure
```
apps/web/tests/
├── components/
│   └── HelloWorld.test.tsx        # Sample component test
├── utils/
│   └── testHelpers.ts             # Testing utilities
└── setup.ts                      # Test configuration

apps/api/tests/
├── health.test.ts                 # Sample API test
└── utils/
    └── testHelpers.ts             # API testing utilities
```

### CI/CD Pipeline Configuration
```yaml
# .github/workflows/ci.yml
name: CI/CD Pipeline
on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: 18
          cache: 'npm'
      - run: npm ci
      - run: npm run test
      - run: npm run lint
      - run: npm run type-check

  deploy-preview:
    if: github.event_name == 'pull_request'
    needs: test
    # Vercel preview deployment

  deploy-production:
    if: github.ref == 'refs/heads/main'
    needs: test
    # Vercel production deployment
```

### Health Check Endpoints
- **Frontend**: `/health` - Shows build version, deployment info
- **Backend**: `/api/health` - Shows API status, database connectivity, environment

### Code Quality Configuration
- **ESLint**: TypeScript, React, monorepo-aware rules
- **Prettier**: Consistent formatting across all files
- **TypeScript**: Strict mode with shared tsconfig.json
- **Pre-commit**: Lint, format, and type-check before commits

### Package.json Scripts
```json
{
  "scripts": {
    "test": "npm run test:web && npm run test:api",
    "test:web": "cd apps/web && vitest run",
    "test:api": "cd apps/api && vitest run",
    "test:watch": "npm run test:web -- --watch",
    "lint": "eslint . --ext .ts,.tsx",
    "lint:fix": "eslint . --ext .ts,.tsx --fix",
    "type-check": "tsc --noEmit",
    "format": "prettier --write \"**/*.{ts,tsx,js,jsx,json,md}\""
  }
}
```

### Dependencies
Requires Story 1.1 (Core Infrastructure Setup) to be completed first.
Runs in parallel with Story 1.1a (Database setup).

### Success Verification
After completion:
1. `npm test` runs all tests and passes
2. `npm run lint` shows no errors
3. GitHub Actions runs on new PR
4. Vercel deployment works automatically
5. Health endpoints return 200 OK with proper JSON

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-02 | 1.0 | Split from original Story 1.1 | Sarah (PO Agent) |

## Dev Agent Record

*This section will be populated during implementation*

## QA Results

*This section will be populated during QA review*