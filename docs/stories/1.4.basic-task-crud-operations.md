# Story 1.4: Basic Task CRUD Operations

## Status
Draft

## Story

**As a** user,
**I want** to create, view, edit, and delete tasks,
**so that** I can manage my task list effectively.

## Acceptance Criteria

1. Tasks save to database with title, description, creation timestamp
2. Task list displays with most recent first
3. Individual task editing with inline or modal interface
4. Task deletion with confirmation prompt
5. Task status toggle (completed/incomplete)
6. Basic search functionality across task titles and descriptions
7. Pagination or infinite scroll for large task lists
8. Display tasks with indented subtask hierarchy
9. Allow manual subtask creation/editing
10. Show parent-child relationships clearly
11. Subtask completion affects parent task progress

## Tasks / Subtasks

- [ ] Create task data models and API endpoints (AC: 1, 8, 9, 10, 11)
  - [ ] Define Task TypeScript interface in shared package
  - [ ] Create Supabase database functions for CRUD operations
  - [ ] Build API endpoints: GET /tasks, POST /tasks, PUT /tasks/:id, DELETE /tasks/:id
  - [ ] Add hierarchical task support with parent_task_id relationships
- [ ] Build task list display component (AC: 2, 8, 10)
  - [ ] Create TaskList component with proper data fetching
  - [ ] Implement task hierarchy visualization with indentation
  - [ ] Add sorting by creation date (most recent first)
  - [ ] Display parent-child relationships with visual indicators
- [ ] Implement task editing functionality (AC: 3, 9)
  - [ ] Create TaskEditModal or inline editing interface
  - [ ] Allow editing task title, description, and basic properties
  - [ ] Add manual subtask creation from parent tasks
  - [ ] Handle editing validation and error states
- [ ] Add task deletion functionality (AC: 4)
  - [ ] Create delete API endpoint with cascade delete for subtasks
  - [ ] Build confirmation modal for delete operations
  - [ ] Handle deletion of tasks with subtasks (confirmation)
  - [ ] Update UI state after successful deletion
- [ ] Implement task completion toggle (AC: 5, 11)
  - [ ] Add status toggle UI (checkbox or similar)
  - [ ] Update task status in database
  - [ ] Calculate and display parent task progress based on subtask completion
  - [ ] Handle completion state visual indicators
- [ ] Add search functionality (AC: 6)
  - [ ] Create search input component
  - [ ] Implement client-side search across title and description
  - [ ] Add search highlighting in results
  - [ ] Handle empty search results state
- [ ] Implement pagination or infinite scroll (AC: 7)
  - [ ] Add pagination component with page navigation
  - [ ] Implement virtual scrolling for performance with large lists
  - [ ] Add loading states for pagination
  - [ ] Handle edge cases (empty lists, single page)

## Dev Notes

### Architecture Context
This story implements the core **task management CRUD operations** using:

- **Database**: Supabase PostgreSQL with hierarchical task schema
- **API Layer**: Vercel Functions with RESTful endpoints
- **Frontend**: React components with TanStack Query for state management
- **Real-time Updates**: Supabase real-time subscriptions for live updates

### Database Schema Implementation
Uses the tasks table from architecture:
```sql
tasks {
  id: UUID PRIMARY KEY,
  user_id: UUID NOT NULL REFERENCES users(id),
  parent_task_id: UUID REFERENCES tasks(id),    -- Hierarchical support
  title: VARCHAR(500) NOT NULL,
  description: TEXT,
  status: VARCHAR(20) DEFAULT 'pending',        -- pending, in_progress, completed
  task_level: INTEGER DEFAULT 0,               -- 0=parent, 1=subtask, 2=sub-subtask
  sequence_order: INTEGER DEFAULT 0,           -- Ordering within breakdown
  created_at: TIMESTAMP DEFAULT NOW(),
  updated_at: TIMESTAMP DEFAULT NOW()
}
```

### API Endpoints Structure
```
/api/tasks/
├── index.ts           # GET /api/tasks (list with hierarchy)
├── create.ts          # POST /api/tasks
├── [id]/
│   ├── index.ts       # GET /api/tasks/:id
│   ├── update.ts      # PUT /api/tasks/:id
│   └── delete.ts      # DELETE /api/tasks/:id
└── search.ts          # GET /api/tasks/search?q=term
```

### Component Architecture
```
apps/web/src/components/
├── TaskList/
│   ├── TaskList.tsx           # Main list component
│   ├── TaskItem.tsx           # Individual task display
│   ├── TaskHierarchy.tsx      # Hierarchical task display
│   └── SubtaskIndicator.tsx   # Visual parent-child indicators
├── TaskEdit/
│   ├── TaskEditModal.tsx      # Task editing interface
│   ├── TaskForm.tsx           # Reusable task form
│   └── SubtaskCreator.tsx     # Manual subtask creation
├── TaskActions/
│   ├── TaskDeleteButton.tsx   # Delete with confirmation
│   ├── TaskToggle.tsx         # Completion status toggle
│   └── TaskProgress.tsx       # Parent task progress indicator
└── Search/
    ├── TaskSearch.tsx         # Search input component
    └── SearchResults.tsx      # Search results display
```

### State Management Strategy
- **Server State**: TanStack Query for API data management
- **Local State**: React state for UI-specific state (modals, editing)
- **Real-time Updates**: Supabase subscriptions for live task updates
- **Optimistic Updates**: Immediate UI updates with rollback on error

### Hierarchical Task Logic
- **Task Levels**: 0 (parent), 1 (subtask), 2 (sub-subtask) - maximum 3 levels
- **Progress Calculation**: Parent completion percentage based on subtask completion rates
- **Deletion Behavior**: Deleting parent cascades to all subtasks with confirmation
- **Visual Hierarchy**: Indentation and visual indicators for parent-child relationships

### Performance Considerations
- **Virtual Scrolling**: For large task lists (100+ items)
- **Pagination**: 20 tasks per page with infinite scroll option
- **Database Indexes**: Proper indexing for user_id, parent_task_id, created_at
- **Query Optimization**: Single query to fetch task hierarchies with joins

### Testing Standards
- **API Tests**: CRUD operations, hierarchical relationships, error handling
- **Component Tests**: Task list rendering, hierarchy display, user interactions
- **Integration Tests**: Full CRUD flow including database operations
- **Performance Tests**: Large dataset handling, virtual scrolling

### Error Handling
- **Validation**: Input validation for task creation/editing
- **Database Errors**: Graceful handling of constraint violations
- **Network Errors**: Retry logic and user-friendly error messages
- **Cascade Deletion**: Proper error handling for hierarchical deletions

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-02 | 1.0 | Initial story creation | Sarah (PO Agent) |

## Dev Agent Record

*This section will be populated during implementation*

## QA Results

*This section will be populated during QA review*